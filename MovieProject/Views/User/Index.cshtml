﻿<!Doctype html>
@using MovieProject.ViewModels
@model List<DAL.Models.DataExtra>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- DataTables CSS -->
    <link href="~/Content/Template/vendor/datatables/css/dataTables.bootstrap.css" rel="stylesheet">
    <!-- DataTables Responsive CSS -->
    <link href="~/Content/Template/vendor/datatables-responsive/dataTables.responsive.css" rel="stylesheet">

</head>

<body>
    <div class="col-lg-pull-12">
        <div class="panel panel-default">

            <div class="panel-heading">
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#UserCreateModal">Create New User</button>
            </div>
            <div class="panel-body">
                <table class="table table-striped table-bordered table-hover " id="myTable">
                    <thead>
                        <tr>
                            <th>
                                Login
                            </th>

                            <th>
                                Role
                            </th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>

                        @foreach (var item in Model)
                        {
                            <tr>

                                <td>
                                    @Html.DisplayFor(modelItem => item.User.Email)
                                </td>

                                <td>
                                    @Html.DisplayFor(modelItem => item.Role)
                                </td>

                                <td>
                                    
                                    <div id="partialContainer">

                                    </div>
                                    <button type="button" class="btn btn-primary " data-extra-id="@item.Id"><span class="tochange">Change Role</span></button>    
                                    
                                </td>
                                <td>
                                   @Html.ActionLink("Details","Details","User", new { id = item.Id }, htmlAttributes: new { @class = "btn btn-default"})
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>

            </div>
        </div>
    </div>
    <div class="modal fade" id="UserCreateModal" tabindex="-1" role="dialog" aria-labelledby="UserCreateModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="UserCreateModalTitle">Create New User</h5>
                </div>
                <div class="modal-body" id="UserCreateModalBody">
                    @Html.Partial("Create", new UsersViewModel())
                </div>
            </div>
        </div>
    </div>




    <!-- jQuery -->
    <script src="~/Content/Template/vendor/jquery/jquery.min.js"></script>
    <!-- DataTables JavaScript -->
    <script src="~/Content/Template/vendor/datatables/js/jquery.dataTables.min.js"></script>
    <script src="~/Content/Template/vendor/datatables-plugins/dataTables.bootstrap.min.js"></script>
    <script src="~/Content/Template/vendor/datatables-responsive/dataTables.responsive.js"></script>
    <!-- Custom Theme JavaScript -->
    <script src="~/Content/Template/dist/js/sb-admin-2.js"></script>
    <!-- Page-Level Demo Scripts - Tables - Use for reference -->
    <script>
        $(document).ready(function () {
            $("#myTable").DataTable({
                responsive: true
            });
        });

        $("")
    </script>

    <script>
        $(".btn-primary").on("click",
            function () {
                debugger;
                if ($(this).children("span").hasClass("tochange")) {
                    var id = $(this).attr("data-extra-id");
                    $(this).parent().children("div").removeClass("hidden");
                    debugger;
                    var thisitem = $(this);
                    $.ajax({
                        url: '@Url.Action("ChangeRole", "User")',
                        dataType: 'html',
                        data: { dataExtraId: id },
                        success: function (result) {
                            thisitem.parent().children("div").html(result);
                            thisitem.children("span").text("Close");
                            thisitem.children("span").addClass("toupdate");
                            thisitem.children("span").removeClass("tochange");
                        }
                    });
                }
                else {
                    if ($(this).children("span").hasClass("toupdate")) {
                        $(this).parent().children("div").addClass("hidden");
                        $(this).children("span").text("Change Role");
                        $(this).children("span").addClass("tochange");
                        $(this).children("span").removeClass("toupdate");
                    }
                }
            //alert($(this).attr("data-date-time"));
            //alert($(this).val());
            });
        $("#backbutton").on("click", function () {
            alert("Go Back");
        });
    </script>

</body>

