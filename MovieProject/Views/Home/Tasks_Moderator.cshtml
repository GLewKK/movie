@model MovieProject.ViewModels.RequestsViewModel
@using DAL.Models
@using Microsoft.AspNet.Identity;
@using Microsoft.AspNet.Identity.EntityFramework;
@{
    ViewBag.Title = "Requests";
}

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- DataTables CSS -->
    <link href="~/Content/Template/vendor/datatables/css/dataTables.bootstrap.css" rel="stylesheet">
    <!-- DataTables Responsive CSS -->
    <link href="~/Content/Template/vendor/datatables-responsive/dataTables.responsive.css" rel="stylesheet">


</head>

<br />
<div class="row">
    <div class="col-lg-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3>Requests</h3>
            </div>
            <div class="panel-body">
                <ul class="nav nav-tabs">
                    <li class="active" id="allli">
                        <a href="#all" data-toggle="tab">All Requests</a>
                    </li>
                    <li id="myli">
                        <a href="#my" data-toggle="tab">My Requests</a>
                    </li>
                    <li>
                        <a href="#completed" data-toggle="tab">Completed Requests</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade in active" id="all">
                        <br />
                        @if (!Model.AllRequests.Any())
                        {
                            <p>No Tasks Available</p>
                        }
                        else
                        {

                            <table class="table table-striped table-bordered table-hover" id="allrequests">
                                <thead>
                                    <tr>
                                        <td>
                                            Request
                                        </td>

                                        <td>
                                            Solicitor
                                        </td>
                                        <td>
                                            Editor
                                        </td>
                                        <td>
                                            Status
                                        </td>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.AllRequests)
                                    {
                                        var manager = new UserManager<ApplicationUser>(new UserStore<ApplicationUser>(new ApplicationDbContext()));
                                        var username = manager.FindById(item.CreditorId).UserName;
                                        <tr>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.Text)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.User.UserName)
                                            </td>
                                            <td>
                                                @Html.Encode(username)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.Status.Name)
                                            </td>
                                            <td>
                                                @Html.ActionLink("Take", "Take", new { id = item.Id }, htmlAttributes: new { @class = "btn  btn-outline btn-primary" })
                                            </td>
                                        </tr>

                                    }
                                </tbody>
                            </table>
                        }
                    </div>
                    <div class="tab-pane " id="my">
                        <br />
                        @if (!Model.MyRequests.Any())
                        {
                            <p>No Current Tasks</p>
                        }
                        else
                        {
                            <br />
                            <table class="table table-striped table-bordered table-hover" id="myrequests">
                                <thead>
                                    <tr>
                                        <td>
                                            Request
                                        </td>
                                        <td>
                                            Solicitor
                                        </td>
                                        <td>
                                            Editor
                                        </td>
                                        <td>
                                            Status
                                        </td>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.MyRequests)
                                    {
                                        var manager = new UserManager<ApplicationUser>(new UserStore<ApplicationUser>(new ApplicationDbContext()));
                                        var username = manager.FindById(item.CreditorId).UserName;
                                        <tr>
                                            <td>
                                                @Html.ActionLink(item.Text, "Request", "Home")
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.User.UserName)
                                            </td>
                                            <td>
                                                @Html.Encode(username)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.Status.Name)
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        }
                    </div>
                    <div class="tab-pane fade" id="completed">
                        <br />
                        @if (!Model.CompletedRequests.Any())
                        {
                            <p>No Tasks Completed</p>
                        }
                        else
                        {
                            <table class="table table-striped table-bordered table-hover" id="completedrequests">
                                <thead>
                                    <tr>
                                        <td>
                                            Request
                                        </td>

                                        <td>
                                            Solicitor
                                        </td>
                                        <td>
                                            Editor
                                        </td>
                                        <td>
                                            Status
                                        </td>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.CompletedRequests)
                                    {
                                        var manager = new UserManager<ApplicationUser>(new UserStore<ApplicationUser>(new ApplicationDbContext()));
                                        var username = manager.FindById(item.CreditorId).UserName;
                                    <tr>
                                        <td>
                                            @Html.DisplayFor(modelItem=>item.Text)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.User.UserName)
                                        </td>
                                        <td>
                                            @Html.Encode(username)
                                        </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Status.Name)
                                        </td>
                                    </tr>
                                    }
                                </tbody>
                            </table>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="~/Scripts/jquery-3.3.1.js"></script>

<script>
    var $j = jQuery.noConflict();
    $j(document).ready(function () {
        debugger;
        if ($j("#myrequests").find("tbody").find("tr").length) {
            $j("#my").addClass("active")
            $j("#all").removeClass("active")
            $j("#myli").addClass("active")
            $j("#allli").removeClass("active")
        }
    });

</script>
<!-- jQuery -->
<script src="~/Content/Template/vendor/jquery/jquery.min.js"></script>
<!-- DataTables JavaScript -->
<script src="~/Content/Template/vendor/datatables/js/jquery.dataTables.min.js"></script>
<script src="~/Content/Template/vendor/datatables-plugins/dataTables.bootstrap.min.js"></script>
<script src="~/Content/Template/vendor/datatables-responsive/dataTables.responsive.js"></script>
<!-- Page-Level Demo Scripts - Tables - Use for reference -->
<script>
    $(document).ready(function () {

        $("table").each(function () {
            if ($(this).find("tbody").find("tr").length > 1) {
                $(this).DataTable({
                    responsive: true
                })
            }
        })
    });
</script>
